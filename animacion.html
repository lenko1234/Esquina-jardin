<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esquina Jardín - Entrelazado Realista</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,700&display=swap"
        rel="stylesheet">

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fcfdfc;
            font-family: 'Playfair Display', serif;
            margin: 0;
            overflow: hidden;
        }

        #canvas-container {
            width: 95%;
            max-width: 900px;
            /* Un poco más ancho para dar espacio */
            position: relative;
        }

        svg {
            width: 100%;
            height: auto;
            overflow: visible;
        }

        /* Definimos el estilo del texto una sola vez */
        .estilo-texto {
            font-size: 80px;
            /* Texto más grande e impactante */
            fill: #3e3226;
            font-style: italic;
            letter-spacing: -2px;
            /* Letras bien juntas para que se toquen */
        }

        .tallo-enredadera {
            fill: none;
            stroke: #558b2f;
            stroke-width: 3px;
            /* Un poco más grueso para que se note el entrelazado */
            stroke-linecap: round;
        }

        .hoja {
            fill: #7cb342;
            opacity: 0;
            transform-origin: bottom left;
        }

        .flor {
            fill: #e57373;
            opacity: 0;
            transform-origin: center;
        }
    </style>
</head>

<body>

    <div id="canvas-container">
        <svg viewBox="0 0 700 200" xmlns="http://www.w3.org/2000/svg">

            <defs>
                <path id="hoja-fina" d="M0,0 Q8,-20 20,-15 T35,-5 Q20,10 5,5 T0,0 Z" />
                <path id="flor-simple" d="M0,0 C-5,-10 5,-10 0,0 C10,-5 10,5 0,0 C5,10 -5,10 0,0 C-10,5 -10,-5 0,0 Z" />

                <text id="texto-base" x="50%" y="130" dominant-baseline="middle" text-anchor="middle"
                    class="estilo-texto">
                    Esquina Jardín
                </text>

                <mask id="mascara-entrelazado">
                    <rect width="100%" height="100%" fill="black" />

                    <rect x="130" y="80" width="140" height="80" fill="white" />
                    <rect x="360" y="80" width="90" height="80" fill="white" />
                    <rect x="540" y="80" width="80" height="80" fill="white" />
                </mask>
            </defs>

            <use href="#texto-base" />

            <path id="tallo-principal" class="tallo-enredadera"
                d="M50,150 C100,150 120,90 200,100 S300,140 380,110 S500,80 600,120" />
            <g id="grupo-hojas"></g>
            <use href="#flor-simple" x="600" y="120" class="flor" width="25" height="25" />

            <use href="#texto-base" mask="url(#mascara-entrelazado)" />

        </svg>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const tallo = document.getElementById('tallo-principal');
            const grupoHojas = document.getElementById('grupo-hojas');
            const longitudTallo = tallo.getTotalLength();

            gsap.set(tallo, { strokeDasharray: longitudTallo, strokeDashoffset: longitudTallo });

            // Aumentamos un poco las hojas para cubrir el nuevo tallo más largo
            const numeroHojas = 14;

            for (let i = 1; i < numeroHojas; i++) {
                const porcentaje = i / numeroHojas;
                const punto = tallo.getPointAtLength(porcentaje * longitudTallo);

                const hoja = document.createElementNS("http://www.w3.org/2000/svg", "use");
                hoja.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#hoja-fina");
                hoja.setAttribute("x", punto.x);
                hoja.setAttribute("y", punto.y);
                hoja.classList.add('hoja');

                // Escala un poco más grande para que se note más
                const escalaFinal = 0.7 + Math.random() * 0.6;

                // Lógica de rotación mejorada para seguir la nueva curva
                // Usamos la tangente para calcular el ángulo real de la curva en ese punto
                const puntoSiguiente = tallo.getPointAtLength(Math.min(porcentaje * longitudTallo + 1, longitudTallo));
                const anguloTangente = Math.atan2(puntoSiguiente.y - punto.y, puntoSiguiente.x - punto.x) * 180 / Math.PI;

                const rotacionBase = (i % 2 === 0) ? -30 : 30;

                gsap.set(hoja, {
                    // Rotamos la hoja basándonos en la dirección del tallo + la alternancia
                    rotation: anguloTangente + rotacionBase + (Math.random() * 15 - 7.5),
                    scale: 0,
                    attr: { "data-scale": escalaFinal }
                });

                grupoHojas.appendChild(hoja);
            }

            const tl = gsap.timeline({ delay: 0.5 });

            tl.to(tallo, {
                strokeDashoffset: 0,
                duration: 2.5, // Un poco más lento para apreciar el recorrido
                ease: "power1.inOut"
            })
                .to('.hoja', {
                    opacity: 1,
                    scale: (i, target) => target.getAttribute("data-scale"),
                    duration: 0.8,
                    stagger: 0.1,
                    ease: "back.out(1.5)",
                    transformOrigin: "bottom left"
                }, "-=2.0")
                .to('.flor', {
                    scale: 1.8,
                    opacity: 1,
                    rotation: 180,
                    duration: 1.2,
                    ease: "elastic.out(1, 0.4)"
                }, "-=0.5")
                .to('.hoja, .flor', {
                    rotation: "+=4", // Movimiento de viento más sutil
                    duration: 4,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut",
                    stagger: { each: 0.15, from: "random" }
                }, "ambiente");
        });
    </script>
</body>

</html>